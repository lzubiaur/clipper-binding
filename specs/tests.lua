local clipper = require 'clipper'
local lust = require 'lust'
local describe, it, expect = lust.describe, lust.it, lust.expect

local scale = 1000000

describe('test clipper ffi binding', function()
  lust.before(function()
  end)

  describe('path usage', function()
    it('can create new path',function()
      local path = clipper.Path()
      expect(path).to.exist()
    end)
    it('can add and get point',function()
      local path = clipper.Path()
      path:add(10,20)
      expect(path:get(1).x).to.be(10)
      expect(path:get(1).y).to.be(20)
      path:add(20,20)
      path:add(40,40)
      path:add(50,120)
      expect(path:size()).to.be(4)
    end)
  end)

  describe('paths usage', function()
    it('can create new paths', function()
      local paths = clipper.Paths()
      expect(paths).to.exist()
    end)
    it('can add and get path', function()
      local p1 = clipper.Path()
      p1:add(10,10)
      p1:add(20,20)
      p1:add(30,50)
      local p2 = clipper.Path()
      p2:add(50,50)
      p2:add(100,60)
      local paths = clipper.Paths()
      paths:add(p1)
      paths:add(p2)
      expect(paths:size()).to.be(2)
      expect(paths:get(1):get(1).x).to.be(10)
      expect(paths:get(1):get(1).y).to.be(10)
      expect(paths:get(1):get(2).x).to.be(20)
      expect(paths:get(1):get(2).y).to.be(20)
      expect(paths:get(1):get(3).x).to.be(30)
      expect(paths:get(1):get(3).y).to.be(50)
      expect(paths:get(2):get(1).x).to.be(50)
      expect(paths:get(2):get(1).y).to.be(50)
      expect(paths:get(2):get(2).x).to.be(100)
      expect(paths:get(2):get(2).y).to.be(60)
    end)
  end)

  describe('path offset',function()
    it('can create an ClipperOffset object',function()
      local co = clipper.ClipperOffset()
      expect(co).to.exist()
    end)
    it('can offset a single path',function()
      local path = clipper.Path()
      path:add(10,20)
      path:add(50,20)
      path:add(50,50)
      local co = clipper.ClipperOffset()
      local out = co:offsetPath(path,10,'miter','openButt')
      expect(out:size()).to.be(1)
      expect(out:get(1):size()).to.be(6)
    end)
  end)
end)
